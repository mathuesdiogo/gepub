{% extends "core/base.html" %}

{% block content %}
<div class="card"><div class="card__body">
  {% include "core/partials/components/layout/page_head.html" with title=title subtitle=subtitle actions=actions %}

  <form method="get" class="filter-bar" style="margin:12px 0;">
    {% if municipios and municipios|length %}
      <select name="municipio" class="input" style="max-width:240px;">
        {% for m in municipios %}
          <option value="{{ m.id }}" {% if municipio and m.id == municipio.id %}selected{% endif %}>{{ m.nome }}/{{ m.uf }}</option>
        {% endfor %}
      </select>
    {% endif %}

    <select name="tipo" class="input" style="max-width:220px;">
      <option value="">Todos os tipos</option>
      {% for key,label in tipo_choices %}
        <option value="{{ key }}" {% if tipo == key %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>

    <select name="turma" class="input" style="max-width:260px;">
      <option value="">Todas as turmas</option>
      {% for item in turmas %}
        <option value="{{ item.turma_id }}" {% if turma_id == item.turma_id|stringformat:'s' %}selected{% endif %}>
          {{ item.turma__nome }} ({{ item.turma__ano_letivo }})
        </option>
      {% endfor %}
    </select>

    <input name="q" value="{{ q }}" class="input" placeholder="Título, disciplina ou turma" style="max-width:300px;">
    <button class="btn btn--sm" type="submit">Filtrar</button>
  </form>

  <div class="table-shell"><div class="table-shell__body">
    <table class="table">
      <thead>
        <tr>
          <th>Avaliação</th>
          <th>Turma</th>
          <th>Data</th>
          <th>Questões</th>
          <th>Aplicações</th>
          <th>Corrigidas</th>
          <th>Média</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td>
              <div class="item-title">{{ item.titulo }}</div>
              <div class="item-subtitle">{{ item.disciplina|default:"Disciplina não informada" }} • {{ item.get_tipo_display }}</div>
            </td>
            <td>{{ item.turma.nome }}</td>
            <td>{{ item.data_aplicacao|date:"d/m/Y" }}</td>
            <td>{{ item.qtd_questoes }}</td>
            <td>{{ item.total_aplicacoes }}</td>
            <td>{{ item.total_corrigidas }}</td>
            <td>{% if item.media %}{{ item.media|floatformat:2 }}{% else %}-{% endif %}</td>
            <td><a class="link" href="{% url 'avaliacoes:avaliacao_detail' item.id %}?municipio={{ municipio.id }}">abrir</a></td>
          </tr>
        {% empty %}
          <tr><td colspan="8">Nenhuma avaliação encontrada.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div></div>
</div></div>
{% endblock %}

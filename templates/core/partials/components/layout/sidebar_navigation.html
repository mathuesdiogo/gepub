{% with ns=rm.namespace|default:'' route=rm.url_name|default:'' %}
<nav class="menu">
  <div class="menu-search" aria-hidden="true">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="text" placeholder="Pesquisar menu" tabindex="-1" />
  </div>

  <div class="menu__section">Acessos Rápidos</div>

  <a class="menu__item menu__item--primary {% if ns == 'core' and route == 'dashboard' %}is-active{% endif %}" href="{% url 'core:dashboard' %}" title="Dashboard">
    <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-house"></i></span>
    <span class="menu__label">Dashboard</span>
  </a>

  {% if not is_professor_role %}
    {% url 'portal' as portal_url %}
    <a class="menu__item menu__item--primary {% if request.path == portal_url %}is-active{% endif %}" href="{{ portal_url }}" title="Módulos">
      <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-table-cells-large"></i></span>
      <span class="menu__label">Módulos</span>
    </a>
  {% endif %}

  {% if can_org or can_financeiro or can_processos or can_compras or can_contratos or can_rh or can_ponto or can_folha or can_patrimonio or can_almoxarifado or can_frota or can_ouvidoria or can_tributos %}
    <div class="menu__section">Gestão Pública</div>

    <details class="menu__group" {% if ns == 'org' or ns == 'financeiro' or ns == 'processos' or ns == 'compras' or ns == 'contratos' or ns == 'rh' or ns == 'ponto' or ns == 'folha' or ns == 'patrimonio' or ns == 'almoxarifado' or ns == 'frota' or ns == 'ouvidoria' or ns == 'tributos' %}open{% endif %}>
      <summary class="menu__group-summary menu__item {% if ns == 'org' or ns == 'financeiro' or ns == 'processos' or ns == 'compras' or ns == 'contratos' or ns == 'rh' or ns == 'ponto' or ns == 'folha' or ns == 'patrimonio' or ns == 'almoxarifado' or ns == 'frota' or ns == 'ouvidoria' or ns == 'tributos' %}is-active{% endif %}">
        <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-briefcase"></i></span>
        <span class="menu__label">Operação</span>
        <span class="menu__caret" aria-hidden="true"><i class="fa-solid fa-chevron-down"></i></span>
      </summary>

      <div class="menu__submenu">
        {% if can_org %}
          <a class="menu__subitem {% if ns == 'org' %}is-active{% endif %}" href="{% url 'org:index' %}"><i class="fa-solid fa-sitemap"></i><span>Organização</span></a>
          {% if can_org_manage_secretaria %}
            <a class="menu__subitem {% if ns == 'org' and 'governanca' in route %}is-active{% endif %}" href="{% url 'org:secretaria_governanca_hub' %}"><i class="fa-solid fa-sliders"></i><span>Governança</span></a>
          {% endif %}
        {% endif %}
        {% if can_financeiro %}
          <a class="menu__subitem {% if ns == 'financeiro' %}is-active{% endif %}" href="{% url 'financeiro:index' %}"><i class="fa-solid fa-landmark"></i><span>Financeiro</span></a>
        {% endif %}
        {% if can_processos %}
          <a class="menu__subitem {% if ns == 'processos' %}is-active{% endif %}" href="{% url 'processos:list' %}"><i class="fa-solid fa-folder-tree"></i><span>Processos</span></a>
        {% endif %}
        {% if can_compras %}
          <a class="menu__subitem {% if ns == 'compras' %}is-active{% endif %}" href="{% url 'compras:index' %}"><i class="fa-solid fa-cart-shopping"></i><span>Compras</span></a>
        {% endif %}
        {% if can_contratos %}
          <a class="menu__subitem {% if ns == 'contratos' %}is-active{% endif %}" href="{% url 'contratos:index' %}"><i class="fa-solid fa-file-signature"></i><span>Contratos</span></a>
        {% endif %}
        {% if can_rh %}
          <a class="menu__subitem {% if ns == 'rh' %}is-active{% endif %}" href="{% url 'rh:index' %}"><i class="fa-solid fa-id-badge"></i><span>RH</span></a>
        {% endif %}
        {% if can_ponto %}
          <a class="menu__subitem {% if ns == 'ponto' %}is-active{% endif %}" href="{% url 'ponto:index' %}"><i class="fa-solid fa-clock"></i><span>Ponto</span></a>
        {% endif %}
        {% if can_folha %}
          <a class="menu__subitem {% if ns == 'folha' %}is-active{% endif %}" href="{% url 'folha:index' %}"><i class="fa-solid fa-money-check-dollar"></i><span>Folha</span></a>
        {% endif %}
        {% if can_patrimonio %}
          <a class="menu__subitem {% if ns == 'patrimonio' %}is-active{% endif %}" href="{% url 'patrimonio:index' %}"><i class="fa-solid fa-building-columns"></i><span>Patrimônio</span></a>
        {% endif %}
        {% if can_almoxarifado %}
          <a class="menu__subitem {% if ns == 'almoxarifado' %}is-active{% endif %}" href="{% url 'almoxarifado:index' %}"><i class="fa-solid fa-boxes-stacked"></i><span>Almoxarifado</span></a>
        {% endif %}
        {% if can_frota %}
          <a class="menu__subitem {% if ns == 'frota' %}is-active{% endif %}" href="{% url 'frota:index' %}"><i class="fa-solid fa-truck"></i><span>Frota</span></a>
        {% endif %}
        {% if can_ouvidoria %}
          <a class="menu__subitem {% if ns == 'ouvidoria' %}is-active{% endif %}" href="{% url 'ouvidoria:index' %}"><i class="fa-solid fa-comments"></i><span>Ouvidoria</span></a>
        {% endif %}
        {% if can_tributos %}
          <a class="menu__subitem {% if ns == 'tributos' %}is-active{% endif %}" href="{% url 'tributos:index' %}"><i class="fa-solid fa-receipt"></i><span>Tributos</span></a>
        {% endif %}
      </div>
    </details>
  {% endif %}

  {% if can_edu or can_nee or can_avaliacoes or can_saude %}
    <div class="menu__section">Educação e Saúde</div>

    <details class="menu__group" {% if ns == 'educacao' or ns == 'nee' or ns == 'avaliacoes' or ns == 'saude' %}open{% endif %}>
      <summary class="menu__group-summary menu__item {% if ns == 'educacao' or ns == 'nee' or ns == 'avaliacoes' or ns == 'saude' %}is-active{% endif %}">
        <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-graduation-cap"></i></span>
        <span class="menu__label">Serviços</span>
        <span class="menu__caret" aria-hidden="true"><i class="fa-solid fa-chevron-down"></i></span>
      </summary>

      <div class="menu__submenu">
        {% if can_edu %}
          {% if is_professor_role %}
            <a class="menu__subitem {% if ns == 'educacao' and route == 'index' %}is-active{% endif %}" href="{% url 'educacao:index' %}"><i class="fa-solid fa-chalkboard-user"></i><span>Painel Professor</span></a>
          {% else %}
            <a class="menu__subitem {% if ns == 'educacao' and route == 'index' %}is-active{% endif %}" href="{% url 'educacao:index' %}"><i class="fa-solid fa-book-open"></i><span>Painel Educação</span></a>
          {% endif %}
          <a class="menu__subitem {% if ns == 'educacao' and route == 'turma_list' %}is-active{% endif %}" href="{% url 'educacao:turma_list' %}"><i class="fa-solid fa-people-group"></i><span>Turmas</span></a>
          <a class="menu__subitem {% if ns == 'educacao' and route == 'aluno_list' %}is-active{% endif %}" href="{% url 'educacao:aluno_list' %}"><i class="fa-solid fa-user-graduate"></i><span>Alunos</span></a>
          <a class="menu__subitem {% if ns == 'educacao' and route == 'meus_diarios' %}is-active{% endif %}" href="{% url 'educacao:meus_diarios' %}"><i class="fa-solid fa-clipboard-check"></i><span>Diário</span></a>
        {% endif %}

        {% if can_avaliacoes %}
          <a class="menu__subitem {% if ns == 'avaliacoes' %}is-active{% endif %}" href="{% url 'avaliacoes:avaliacao_list' %}"><i class="fa-solid fa-file-circle-check"></i><span>Avaliações</span></a>
        {% endif %}

        {% if can_nee %}
          <a class="menu__subitem {% if ns == 'nee' and route == 'index' %}is-active{% endif %}" href="{% url 'nee:index' %}"><i class="fa-solid fa-universal-access"></i><span>Painel NEE</span></a>
        {% endif %}

        {% if can_saude %}
          <a class="menu__subitem {% if ns == 'saude' and route == 'index' %}is-active{% endif %}" href="{% url 'saude:index' %}"><i class="fa-solid fa-heart-pulse"></i><span>Painel Saúde</span></a>
          <a class="menu__subitem {% if ns == 'saude' and route == 'atendimento_list' %}is-active{% endif %}" href="{% url 'saude:atendimento_list' %}"><i class="fa-solid fa-notes-medical"></i><span>Atendimentos</span></a>
        {% endif %}
      </div>
    </details>
  {% endif %}

  {% if can_conversor or can_paineis or can_integracoes %}
    <div class="menu__section">Ferramentas</div>

    <details class="menu__group" {% if ns == 'conversor' or ns == 'paineis' or ns == 'integracoes' %}open{% endif %}>
      <summary class="menu__group-summary menu__item {% if ns == 'conversor' or ns == 'paineis' or ns == 'integracoes' %}is-active{% endif %}">
        <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-screwdriver-wrench"></i></span>
        <span class="menu__label">Ferramentas</span>
        <span class="menu__caret" aria-hidden="true"><i class="fa-solid fa-chevron-down"></i></span>
      </summary>

      <div class="menu__submenu">
        {% if can_conversor %}
          <a class="menu__subitem {% if ns == 'conversor' %}is-active{% endif %}" href="{% url 'conversor:index' %}"><i class="fa-solid fa-file-pdf"></i><span>Gerenciador de PDFs</span></a>
        {% endif %}
        {% if can_paineis %}
          <a class="menu__subitem {% if ns == 'paineis' %}is-active{% endif %}" href="{% url 'paineis:dataset_list' %}"><i class="fa-solid fa-chart-simple"></i><span>Power BI</span></a>
        {% endif %}
        {% if can_integracoes %}
          <a class="menu__subitem {% if ns == 'integracoes' %}is-active{% endif %}" href="{% url 'integracoes:index' %}"><i class="fa-solid fa-plug-circle-bolt"></i><span>Integrações</span></a>
        {% endif %}
      </div>
    </details>
  {% endif %}

  {% if can_publicacoes_admin or can_system_admin %}
    <div class="menu__section">Site Prefeitura</div>

    <details class="menu__group" {% if ns == 'core' and 'publicacoes' in route or ns == 'core' and 'noticia_' in route or ns == 'core' and 'banner_' in route or ns == 'core' and 'pagina_' in route or ns == 'core' and 'menu_' in route or ns == 'core' and 'home_bloco_' in route or ns == 'core' and route == 'institutional_admin' %}open{% endif %}>
      <summary class="menu__group-summary menu__item {% if ns == 'core' and 'publicacoes' in route or ns == 'core' and 'noticia_' in route or ns == 'core' and 'banner_' in route or ns == 'core' and 'pagina_' in route or ns == 'core' and 'menu_' in route or ns == 'core' and 'home_bloco_' in route or ns == 'core' and route == 'institutional_admin' %}is-active{% endif %}">
        <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-pen-ruler"></i></span>
        <span class="menu__label">Editor do Site</span>
        <span class="menu__caret" aria-hidden="true"><i class="fa-solid fa-chevron-down"></i></span>
      </summary>

      <div class="menu__submenu">
        {% if can_publicacoes_admin %}
          <a class="menu__subitem {% if ns == 'core' and 'publicacoes' in route or ns == 'core' and 'noticia_' in route or ns == 'core' and 'banner_' in route or ns == 'core' and 'pagina_' in route or ns == 'core' and 'menu_' in route or ns == 'core' and 'home_bloco_' in route %}is-active{% endif %}" href="{% url 'core:publicacoes_admin' %}"><i class="fa-solid fa-globe"></i><span>Editar Site Prefeitura</span></a>
        {% endif %}
        {% if can_system_admin %}
          <a class="menu__subitem {% if ns == 'core' and route == 'publicacoes_theme_editor' %}is-active{% endif %}" href="{% url 'core:publicacoes_theme_editor' %}"><i class="fa-solid fa-palette"></i><span>Editar Tema (Admin)</span></a>
          <a class="menu__subitem {% if ns == 'core' and route == 'institutional_admin' %}is-active{% endif %}" href="{% url 'core:institutional_admin' %}"><i class="fa-solid fa-pen-to-square"></i><span>Editor Institucional</span></a>
          <a class="menu__subitem" href="/admin/"><i class="fa-solid fa-shield-halved"></i><span>Admin Django</span></a>
        {% endif %}
      </div>
    </details>
  {% endif %}

  {% if can_billing or can_billing_admin %}
    <div class="menu__section">Plano</div>

    <details class="menu__group" {% if ns == 'billing' %}open{% endif %}>
      <summary class="menu__group-summary menu__item {% if ns == 'billing' %}is-active{% endif %}">
        <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-credit-card"></i></span>
        <span class="menu__label">Assinatura</span>
        <span class="menu__caret" aria-hidden="true"><i class="fa-solid fa-chevron-down"></i></span>
      </summary>

      <div class="menu__submenu">
        {% if can_billing %}
          <a class="menu__subitem {% if ns == 'billing' and route == 'meu_plano' %}is-active{% endif %}" href="{% url 'billing:meu_plano' %}"><i class="fa-solid fa-file-contract"></i><span>Meu Plano</span></a>
        {% endif %}
        {% if can_billing_admin %}
          <a class="menu__subitem {% if ns == 'billing' and route == 'assinaturas_admin' or ns == 'billing' and route == 'assinatura_admin_detail' %}is-active{% endif %}" href="{% url 'billing:assinaturas_admin' %}"><i class="fa-solid fa-building-shield"></i><span>Assinaturas (Admin)</span></a>
        {% endif %}
      </div>
    </details>
  {% endif %}

  <div class="menu__section">Conta</div>

  <a class="menu__item {% if ns == 'accounts' and route == 'meu_perfil' %}is-active{% endif %}" href="{% url 'accounts:meu_perfil' %}" title="Meu perfil">
    <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-user"></i></span>
    <span class="menu__label">Meu Perfil</span>
  </a>

  <a class="menu__item {% if ns == 'accounts' and route == 'alterar_senha' %}is-active{% endif %}" href="{% url 'accounts:alterar_senha' %}" title="Alterar senha">
    <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-key"></i></span>
    <span class="menu__label">Alterar Senha</span>
  </a>

  {% if can_users %}
    <a class="menu__item {% if ns == 'accounts' and route == 'usuarios_list' %}is-active{% endif %}" href="{% url 'accounts:usuarios_list' %}" title="Usuários">
      <span class="menu__icon" aria-hidden="true"><i class="fa-solid fa-users"></i></span>
      <span class="menu__label">Usuários</span>
    </a>
  {% endif %}
</nav>
{% endwith %}

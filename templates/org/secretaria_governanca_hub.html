{% extends "core/base.html" %}
{% block title %}Governanca de Secretarias • GEPUB{% endblock %}
{% block header %}Organização{% endblock %}

{% block content %}
<div class="card"><div class="card__body">
  {% include "core/partials/components/layout/page_head.html" with title=title subtitle=subtitle actions=actions %}
  {% include "org/partials/nav_tabs.html" %}

  <form method="get" class="filter-bar" style="margin-top:12px; margin-bottom:12px;">
    <div class="filter-bar__field">
      <label class="small">Município</label>
      <select name="municipio">
        {% for m in municipios %}
          <option value="{{ m.pk }}" {% if municipio and municipio.pk == m.pk %}selected{% endif %}>{{ m.nome }}/{{ m.uf }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="filter-bar__field">
      <label class="small">Buscar secretaria</label>
      <input type="text" name="q" value="{{ q }}" placeholder="Nome, sigla ou tipo de modelo">
    </div>
    <div class="filter-bar__actions">
      <button class="btn btn-primary" type="submit"><i class="fa-solid fa-filter"></i> Filtrar</button>
      <a class="btn btn--ghost" href="{% url 'org:secretaria_governanca_hub' %}{% if municipio %}?municipio={{ municipio.pk }}{% endif %}">
        <i class="fa-solid fa-eraser"></i> Limpar
      </a>
    </div>
  </form>

  <div class="table-shell">
    <table class="table">
      <thead>
        <tr>
          <th>Secretaria</th>
          <th>Tipo modelo</th>
          <th>Módulos ativos</th>
          <th>Configurações</th>
          <th>Cadastros-base</th>
          <th width="200">Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td>
              <div class="item-title">{{ item.nome }}</div>
              <div class="item-subtitle">{{ item.sigla|default:"-" }}</div>
            </td>
            <td>{{ item.tipo_modelo|default:"-" }}</td>
            <td>{{ item.total_modulos }}</td>
            <td>{{ item.total_configuracoes }}</td>
            <td>{{ item.total_cadastros }}</td>
            <td>
              <a class="btn btn-primary" href="{% url 'org:secretaria_governanca_detail' item.pk %}">
                <i class="fa-solid fa-sliders"></i> Gerir
              </a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6">Nenhuma secretaria encontrada para os filtros informados.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div></div>
{% endblock %}

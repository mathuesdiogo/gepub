{% extends "core/base.html" %}
{% block title %}{{ title }} • GEPUB{% endblock %}
{% block header %}Organização{% endblock %}

{% block content %}
<div class="card"><div class="card__body">
  {% include "core/partials/components/layout/page_head.html" with title=title subtitle=subtitle actions=actions %}
  {% include "org/partials/nav_tabs.html" %}

  <section class="org-info-grid" style="margin-top:12px;">
    <article class="org-info-card">
      <p class="org-info-card__label">Tipo do modelo</p>
      <p class="org-info-card__value">{{ secretaria.tipo_modelo|default:"-" }}</p>
      <p class="org-info-card__meta">Template aplicado no onboarding</p>
    </article>
    <article class="org-info-card">
      <p class="org-info-card__label">Configurações</p>
      <p class="org-info-card__value">{{ configuracoes|length }}</p>
      <p class="org-info-card__meta">Parâmetros ativos para esta secretaria</p>
    </article>
    <article class="org-info-card">
      <p class="org-info-card__label">Categorias base</p>
      <p class="org-info-card__value">{{ cadastros_por_categoria|length }}</p>
      <p class="org-info-card__meta">Grupos de referência operacional</p>
    </article>
  </section>

  <section class="dash-card" style="margin-top:14px;">
    <div class="dash-card__head">
      <div>
        <div class="dash-card__title">Configurações da secretaria</div>
        <div class="dash-card__sub">Controle de chaves/valores usados no onboarding e nas rotinas administrativas</div>
      </div>
      <a class="btn btn-primary" href="{% url 'org:secretaria_configuracao_create' secretaria.pk %}">
        <i class="fa-solid fa-plus"></i> Nova configuração
      </a>
    </div>
    <div class="dash-card__body">
      <div class="table-shell">
        <table class="table">
          <thead>
            <tr>
              <th>Chave</th>
              <th>Descrição</th>
              <th>Valor</th>
              <th width="220">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for cfg in configuracoes %}
              <tr>
                <td><code>{{ cfg.chave }}</code></td>
                <td>{{ cfg.descricao|default:"-" }}</td>
                <td><code>{{ cfg.valor }}</code></td>
                <td>
                  <a class="btn btn--ghost" href="{% url 'org:secretaria_configuracao_update' cfg.pk %}">
                    <i class="fa-solid fa-pen"></i> Editar
                  </a>
                  <form method="post" action="{% url 'org:secretaria_configuracao_delete' cfg.pk %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn--ghost">
                      <i class="fa-solid fa-trash"></i> Remover
                    </button>
                  </form>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4">Nenhuma configuração cadastrada para esta secretaria.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="dash-card" style="margin-top:14px;">
    <div class="dash-card__head">
      <div>
        <div class="dash-card__title">Cadastros-base por categoria</div>
        <div class="dash-card__sub">Listas de referência usadas nos formulários operacionais dos módulos</div>
      </div>
      <a class="btn btn-primary" href="{% url 'org:secretaria_cadastro_base_create' secretaria.pk %}">
        <i class="fa-solid fa-plus"></i> Novo cadastro-base
      </a>
    </div>
    <div class="dash-card__body">
      {% if cadastros_por_categoria %}
        {% for categoria, itens in cadastros_por_categoria %}
          <div style="margin-bottom:16px;">
            <div class="item-title" style="margin-bottom:8px;">{{ categoria }}</div>
            <div class="table-shell">
              <table class="table">
                <thead>
                  <tr>
                    <th>Ordem</th>
                    <th>Código</th>
                    <th>Nome</th>
                    <th>Ativo</th>
                    <th>Metadata</th>
                    <th width="220">Ações</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in itens %}
                    <tr>
                      <td>{{ item.ordem }}</td>
                      <td>{{ item.codigo|default:"-" }}</td>
                      <td>{{ item.nome }}</td>
                      <td>{{ item.ativo|yesno:"Sim,Não" }}</td>
                      <td><code>{{ item.metadata }}</code></td>
                      <td>
                        <a class="btn btn--ghost" href="{% url 'org:secretaria_cadastro_base_update' item.pk %}">
                          <i class="fa-solid fa-pen"></i> Editar
                        </a>
                        <form method="post" action="{% url 'org:secretaria_cadastro_base_delete' item.pk %}" style="display:inline;">
                          {% csrf_token %}
                          <button type="submit" class="btn btn--ghost">
                            <i class="fa-solid fa-trash"></i> Remover
                          </button>
                        </form>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>Nenhum cadastro-base cadastrado para esta secretaria.</p>
      {% endif %}
    </div>
  </section>
</div></div>
{% endblock %}

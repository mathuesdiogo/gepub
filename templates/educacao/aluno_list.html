{% extends "core/base.html" %}
{% block title %}Alunos • Educação • GEPUB{% endblock %}
{% block header %}Educação{% endblock %}

{% block breadcrumbs %}
  <div class="breadcrumbs">
    <a class="breadcrumbs__link" href="{% url 'core:dashboard' %}">Início</a>
    <span class="breadcrumbs__sep">/</span>
    <a class="breadcrumbs__link" href="{% url 'educacao:index' %}">Educação</a>
    <span class="breadcrumbs__sep">/</span>
    <span class="breadcrumbs__current">Alunos</span>
  </div>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card__title" style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
    <span>Alunos</span>
   {% if can_edu_manage %}
  <a class="btn btn-primary" href="{% url 'educacao:aluno_create' %}">Novo Aluno</a>
{% endif %}

  </div>

  <div class="card__body">
    <form method="get" style="display:flex; gap:10px; flex-wrap:wrap; align-items:end; margin-bottom:12px;">
      <div style="min-width:260px; flex:1;">
        <label class="small">Buscar</label><br>
        <input name="q" value="{{ q }}" placeholder="Nome, CPF, NIS, mãe..." />
      </div>
      <button type="submit">Filtrar</button>
      {% if q %}
        <a class="link" href="{% url 'educacao:aluno_list' %}">Limpar</a>
      {% endif %}
    </form>

    <div style="overflow:auto; border:1px solid rgba(255,255,255,.08); border-radius:14px;">
      <table style="width:100%; border-collapse:collapse; min-width:820px;">
        <thead>
          <tr style="text-align:left; background:rgba(255,255,255,.03);">
            <th style="padding:10px 12px;">Nome</th>
            <th style="padding:10px 12px; width:160px;">CPF</th>
            <th style="padding:10px 12px; width:160px;">NIS</th>
            <th style="padding:10px 12px; width:140px;">Ativo</th>
            <th style="padding:10px 12px; width:140px;">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for a in page_obj %}
            <tr style="border-top:1px solid rgba(255,255,255,.06);">
              <td style="padding:10px 12px;">
                <a class="link" href="{% url 'educacao:aluno_detail' a.pk %}">{{ a.nome }}</a>
              </td>
              <td style="padding:10px 12px;">{{ a.cpf|default:"—" }}</td>
              <td style="padding:10px 12px;">{{ a.nis|default:"—" }}</td>
              <td style="padding:10px 12px;">{% if a.ativo %}Sim{% else %}Não{% endif %}</td>
              <td style="padding:10px 12px;">
              {% if can_edu_manage %}
  <a class="link" href="{% url 'educacao:aluno_update' aluno.pk %}">Editar</a>
{% endif %}

              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5" style="padding:12px;">Nenhum aluno encontrado.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if page_obj.paginator.num_pages > 1 %}
      <div style="display:flex; gap:10px; align-items:center; margin-top:12px; flex-wrap:wrap;">
        <span class="small">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        <div style="display:flex; gap:8px; align-items:center;">
          {% if page_obj.has_previous %}
            <a class="link" href="?q={{ q|urlencode }}&page={{ page_obj.previous_page_number }}">Anterior</a>
          {% endif %}
          {% if page_obj.has_next %}
            <a class="link" href="?q={{ q|urlencode }}&page={{ page_obj.next_page_number }}">Próxima</a>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% extends "core/base.html" %}

{% block content %}
<div class="card"><div class="card__body">
  {% include "core/partials/components/layout/page_head.html" with title=title subtitle=subtitle actions=actions %}

  <form method="get" class="filter-bar" style="margin-bottom:12px;">
    {% if municipios and municipios|length %}
      <select name="municipio" class="input" style="max-width:240px;">
        {% for m in municipios %}
          <option value="{{ m.id }}" {% if municipio and m.id == municipio.id %}selected{% endif %}>{{ m.nome }}/{{ m.uf }}</option>
        {% endfor %}
      </select>
    {% endif %}

    <select name="exercicio" class="input" style="max-width:220px;">
      <option value="">Todos os exercícios</option>
      {% for ex in exercicios %}
        <option value="{{ ex.id }}" {% if exercicio and ex.id == exercicio.id %}selected{% endif %}>{{ ex.ano }}</option>
      {% endfor %}
    </select>

    <input name="q" value="{{ q }}" class="input" placeholder="Programa, ação, elemento" style="max-width:260px;">
    <button class="btn btn--sm" type="submit">Filtrar</button>
  </form>

  <div class="table-shell"><div class="table-shell__body">
    <table class="table">
      <thead>
        <tr><th>Exercício</th><th>UG</th><th>Classificação</th><th>Fonte</th><th>Atualizado</th><th>Empenhado</th><th>Saldo</th></tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td>{{ item.exercicio.ano }}</td>
            <td>{{ item.unidade_gestora.codigo }}</td>
            <td>
              {{ item.programa_codigo }} / {{ item.acao_codigo }} / {{ item.elemento_despesa }}
              <small style="display:block;color:#6b7f95;">{{ item.programa_nome }} • {{ item.acao_nome }}</small>
            </td>
            <td>{{ item.fonte.codigo }}</td>
            <td>R$ {{ item.valor_atualizado }}</td>
            <td>R$ {{ item.valor_empenhado }}</td>
            <td>R$ {{ item.saldo_disponivel }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="7">Nenhuma dotação encontrada.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div></div>
</div></div>
{% endblock %}
